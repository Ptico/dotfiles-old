#compdef rake

if [ -f Capfile ]; then
	recent=`ls -t .cap_tasks~ Capfile **/deploy.rb **/deploy/*.rb 2> /dev/null 1| head -n 1`
	if [[ $recent != '.cap_tasks~' ]]; then
		cap --tasks --tool --verbose > .cap_tasks~
	fi
	compadd `cat .cap_tasks~`
fi